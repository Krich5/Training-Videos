<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Training Videos</title>
  <meta name="color-scheme" content="dark">
  <style>
    :root{ --bg:#0b1020; --card:#131a2a; --muted:#92a0b8; --fg:#e9edf5; --accentA:#22d3ee; --accentB:#3b82f6; --border:rgba(255,255,255,.08);}
    *,*::before,*::after{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,"Noto Sans";background:var(--bg);color:var(--fg);min-height:100vh}
    header{padding:14px 18px;border-bottom:1px solid rgba(255,255,255,.06)}
    .wrap{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:1fr auto 1fr;align-items:center}
    .left{justify-self:start}
    .center{justify-self:center;text-align:center}
    .right{justify-self:end}
    .brand{font-weight:800;letter-spacing:.2px}
    .logo{height:36px}
    .btnLink{background:#0e1525;color:var(--fg);border:1px solid var(--border);font-weight:800;padding:8px 14px;border-radius:12px;text-decoration:none}
    main{max-width:1100px;margin:24px auto;padding:0 16px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:18px}
    .title{font-size:1.1rem;font-weight:800;margin-bottom:8px}
    .muted{color:var(--muted)}
    .btn{background:linear-gradient(135deg,var(--accentA),var(--accentB));border:none;color:#06111d;font-weight:800;padding:8px 14px;border-radius:12px;cursor:pointer}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    video{width:100%;max-height:60vh;border-radius:12px;border:1px solid var(--border);background:black}
    ul{margin-top:10px}
    li{margin:6px 0}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="left"><a class="btnLink" href="index.html">← Back</a></div>
      <div class="center"><div id="hdr" class="brand">Training Videos</div></div>
      <div class="right"><img src="CX%20Advanced%20Solutions_Smaller_white.png" alt="CX Advanced Solutions" class="logo"/></div>
    </div>
  </header>

  <main>
    <section class="card">
      <div class="title" id="seriesTitle"></div>
      <div class="muted" id="who"></div>

      <div style="margin-top:14px">
        <video id="player" controls playsinline></video>
      </div>

      <div class="row" style="margin-top:12px">
        <button id="prevBtn" class="btn">Prev</button>
        <button id="nextBtn" class="btn">Next</button>
        <div class="muted" id="progress"></div>
      </div>

      <div style="margin-top:10px">
        <strong>Playlist</strong>
        <ul id="list"></ul>
      </div>
    </section>
  </main>

  <script>
  // ===== set this to your current Apps Script /exec URL =====
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxuPTsJ2ZNV2PLmTFEmYQsHza7P4mFOgnfNFgjGz-3NFgwa1RU_4fcjwskW9AAfEDrB/exec";

  // Read who/what from session
  const name = sessionStorage.getItem('tv_name') || 'Guest';
  const course = sessionStorage.getItem('tv_course') || 'agent';
  const company = sessionStorage.getItem('tv_company') || '';

  document.getElementById('hdr').textContent =
    (course === 'supervisor' ? 'Supervisor Training Videos' :
     course === 'admin' ? 'Admin Training Videos' : 'Agent Training Videos');

  document.getElementById('seriesTitle').textContent =
    (course === 'supervisor' ? 'Supervisor Series' :
     course === 'admin' ? 'Admin Series' : 'Agent Series');

  document.getElementById('who').textContent = `${name}${company ? ' • ' + company : ''}`;

  // Playlists by course
  const PLAYLISTS = {
    agent: [
      ['Agent login','AgentVideos/Agent%20Login%20(Desktop).mp4'],
      ['Profile settings','AgentVideos/Profiles%20Settings.mp4'],
      ['Agent state','AgentVideos/Agent%20State.mp4'],
      ['Outbound calling','AgentVideos/Outbound%20Calling.mp4'],
      ['Side navigation','AgentVideos/Side%20Navigation.mp4'],
      ['Sign out','AgentVideos/Sign%20Out.mp4']
    ],
    supervisor: [
      ['Example supervisor clip','SupVideos/IMG_3339.mov']
    ],
    admin: [
      ['Admin intro','AgentVideos/Agent%20Login%20(Desktop).mp4']
    ]
  };

  const videos = PLAYLISTS[course] || PLAYLISTS.agent;

  // Simple logger (POST text/plain to avoid preflight)
  async function logEvent(payload){
    try{
      await fetch(SCRIPT_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain' },
        body: JSON.stringify(payload)
      });
    }catch(_){}
  }

  // Build UI
  const list = document.getElementById('list');
  const player = document.getElementById('player');
  const progress = document.getElementById('progress');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');

  let idx = 0;
  function renderList(){
    list.innerHTML = videos.map((v,i)=>`<li${i===idx?' style="font-weight:800"':''}>${v[0]}</li>`).join('');
    progress.textContent = `Video ${idx+1} of ${videos.length}`;
  }
  function load(i){
    idx = Math.max(0, Math.min(videos.length-1, i));
    player.src = videos[idx][1];
    player.currentTime = 0;
    renderList();
  }
  prevBtn.onclick = ()=> load(idx-1);
  nextBtn.onclick = ()=> load(idx+1);

  // On complete, go next (and log completion)
  player.addEventListener('ended', ()=>{
    logEvent({
      type:'completion',
      name, course, company,
      ts: Date.now(),
      page: 'videos',
      ua: navigator.userAgent,
      videos: { index: idx, title: videos[idx][0], src: videos[idx][1] }
    });
    if (idx < videos.length-1) load(idx+1);
  });

  // Start
  renderList();
  load(0);
  </script>
</body>
</html>
