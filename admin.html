<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Training Admin</title>
<style>
body{margin:0;font-family:ui-sans-serif,system-ui;background:#0b1020;color:#e9edf5;min-height:100vh;padding:30px}
.card{background:#131a2a;border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:20px;margin:auto;max-width:1000px}
h1{text-align:center}
.btn{background:linear-gradient(135deg,#22d3ee,#3b82f6);border:none;color:#06111d;font-weight:700;padding:8px 14px;border-radius:10px;cursor:pointer}
input{border-radius:10px;border:1px solid rgba(255,255,255,.08);background:#0e1525;color:#e9edf5;padding:10px 12px;outline:none}
.err{color:#f87171;font-weight:700;text-align:center;margin-top:8px}
table{width:100%;border-collapse:collapse;margin-top:16px}
th,td{border-bottom:1px solid rgba(255,255,255,.1);padding:6px 8px;text-align:left}
th{background:#0e1525;position:sticky;top:0}
</style>
</head>
<body>
<div class="card" id="loginCard">
  <h1>Admin Login</h1>
  <input id="adminPass" type="password" placeholder="Enter admin password">
  <button id="loginBtn" class="btn">Sign in</button>
  <div id="err" class="err"></div>
</div>

<div class="card" id="app" style="display:none">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h1>Training Admin</h1>
    <button id="logoutBtn" class="btn">Log out</button>
  </div>
  <button id="addBtn" class="btn">Add Company</button>
  <button id="refreshBtn" class="btn">Refresh</button>
  <table>
    <thead><tr><th>Company</th><th>Agent</th><th>Supervisor</th><th>Admin</th><th>Active</th><th>Created</th></tr></thead>
    <tbody id="custBody"><tr><td colspan="6">No data</td></tr></tbody>
  </table>
</div>

<script>
const SCRIPT_URL="YOUR_EXEC_URL_HERE";
const ADMIN_PASS="cooladmin";
const ADMIN_TOKEN="CXASTrainingPortal25";

const login=document.getElementById('loginCard');
const app=document.getElementById('app');
const err=document.getElementById('err');

document.getElementById('loginBtn').onclick=()=>{
  const val=document.getElementById('adminPass').value.trim();
  if(val===ADMIN_PASS){login.style.display='none';app.style.display='block';loadCustomers();}
  else err.textContent='Incorrect password';
};
document.getElementById('logoutBtn').onclick=()=>{app.style.display='none';login.style.display='block';};

document.getElementById('addBtn').onclick=async()=>{
  const company=prompt('Company name'); if(!company) return;
  const res=await fetch(SCRIPT_URL,{method:'POST',headers:{'Content-Type':'application/json'},
    body:JSON.stringify({mode:'addCompany',token:ADMIN_TOKEN,company})});
  const data=await res.json();
  if(data.ok) {alert(`Codes:\nAgent: ${data.agent}\nSupervisor: ${data.supervisor}\nAdmin: ${data.admin}`); loadCustomers();}
  else alert('Error adding');
};

document.getElementById('refreshBtn').onclick=loadCustomers;

async function loadCustomers(){
  const res=await fetch(`${SCRIPT_URL}?mode=customers&token=${ADMIN_TOKEN}`);
  const data=await res.json();
  const body=document.getElementById('custBody');
  const rows=data.rows||[];
  if(!rows.length){body.innerHTML='<tr><td colspan="6">No companies</td></tr>';return;}
  body.innerHTML=rows.map(r=>`<tr><td>${r.company}</td><td>${r.agent_code}</td><td>${r.supervisor_code}</td><td>${r.admin_code}</td><td>${r.active?'Yes':'No'}</td><td>${r.created_ts}</td></tr>`).join('');
}
</script>
</body>
</html>
