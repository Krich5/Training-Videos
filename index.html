<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Training Access</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main class="card">
    <h1>Training Series</h1>
    <p>Please enter your name and the access password.</p>

    <form id="gateForm">
      <label>
        Your name
        <input id="name" name="name" type="text" required />
      </label>

      <label>
        Password
        <input id="password" name="password" type="password" inputmode="text" required />
      </label>

      <button type="submit">Enter</button>
      <p id="error" class="error" role="alert" aria-live="polite"></p>
      <p class="muted" id="help"></p>
    </form>
  </main>

  <!-- Inline gate (no external file needed) -->
  <script>
  // --- config ---
  const PASSWORD_PLAIN = "cooldemo";                       // quick, reliable check
  const EMAIL_OWNER = "Kenley.richardson@gmail.com";
  const WEBHOOK_URL = "PASTE_YOUR_APPS_SCRIPT_WEB_APP_URL_HERE"; // set in step 2

  // Minimal gate helpers
  window.gate = (() => {
    function isAuthed(){ return sessionStorage.getItem('authed') === 'true'; }
    function requireAuthOrRedirect(){ if(!isAuthed()) location.href = "index.html"; }
    return { isAuthed, requireAuthOrRedirect };
  })();

  // Render help link
  document.getElementById('help').innerHTML =
    `Need help? <a href="mailto:${encodeURIComponent(EMAIL_OWNER)}?subject=${encodeURIComponent('Training access help')}">Email ${EMAIL_OWNER}</a>`;

  // Handle submit
  const form = document.getElementById('gateForm');
  const nameInput = document.getElementById('name');
  const passInput = document.getElementById('password');
  const errorEl = document.getElementById('error');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    errorEl.textContent = "";

    const name = nameInput.value.trim();
    const pass = passInput.value;

    try {
      if (pass === PASSWORD_PLAIN) {
        // mark session
        sessionStorage.setItem('authed', 'true');
        sessionStorage.setItem('visitorName', name);

        // fire-and-forget email webhook (donâ€™t block the redirect)
        try {
          fetch(WEBHOOK_URL, {
            method: "POST",
            mode: "no-cors",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              name,
              ts: new Date().toISOString(),
              ua: navigator.userAgent,
              page: location.href
            })
          });
        } catch (_) { /* ignore */ }

        // go to videos
        location.href = "videos.html";
      } else {
        errorEl.textContent = "Incorrect password. Please try again.";
      }
    } catch (err) {
      console.error(err);
      errorEl.textContent = "Something went wrong. Please try again.";
    }
  });
  </script>
</body>
</html>