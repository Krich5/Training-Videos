<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Training Portal</title>
<meta name="color-scheme" content="dark light">
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<style>
:root{
  --bg:#0b1020; --bg2:#0a132a; --card:#131a2a; --muted:#92a0b8; --fg:#e9edf5;
  --input:#0e1525; --border:rgba(255,255,255,.08); --accentA:#22d3ee; --accentB:#3b82f6;
}
:root[data-theme="light"]{ --bg:#f6f7fb; --bg2:#eef2f8; --card:#ffffff; --fg:#0f172a; --input:#f3f4f6; --border:rgba(15,23,42,.12); --muted:#64748b; }
*{box-sizing:border-box} body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;
background:linear-gradient(180deg,var(--bg),var(--bg2));color:var(--fg);min-height:100vh;}
header{padding:14px 18px;border-bottom:1px solid var(--border)}
.hgrid{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:1fr auto 1fr;align-items:center}
.left{justify-self:start}.center{justify-self:center}.right{justify-self:end}
.brand{font-weight:800;letter-spacing:.2px}
.logo{height:36px}
.btnLink{background:var(--input);color:var(--fg);border:1px solid var(--border);font-weight:800;padding:8px 14px;border-radius:12px;text-decoration:none}
.toggle{border:1px solid var(--border);background:var(--input);padding:6px 10px;border-radius:999px;cursor:pointer}
main{max-width:1100px;margin:32px auto;padding:0 16px}
.card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:22px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
h1{margin:0 0 6px 0;text-align:center} .sub{color:var(--muted);text-align:center;margin-bottom:16px}
label{display:block;font-size:13px;color:var(--muted);margin:8px 0 6px} input{width:100%;border-radius:10px;border:1px solid var(--border);background:var(--input);color:var(--fg);padding:10px 12px;outline:none}
.row{display:flex;justify-content:center;margin-top:16px}
.btn{background:linear-gradient(135deg,var(--accentA),var(--accentB));border:none;color:#06111d;font-weight:800;padding:10px 18px;border-radius:12px;cursor:pointer}
.err{margin-top:12px;text-align:center;color:#f87171;font-weight:700}
footer{margin:28px 0;text-align:center;color:var(--muted)}
</style>

<!-- Try to load external config -->
<script src="config.js?v=1001"></script>

<!-- Fallback config if the above fails or is stale -->
<script>
(function ensureConfig(){
  const FALLBACK_URL = "https://script.google.com/macros/s/AKfycbzANcSixCAEfvqcj7fOfAQn7TaHkeYcOh3msNSeuwkK2eKwdLTqgQ0U9jCJXSyrswJW/exec"; // <- fixed "https://"
  if (!window.APP_CONFIG || !window.APP_CONFIG.SCRIPT_URL) {
    window.APP_CONFIG = {
      SCRIPT_URL: FALLBACK_URL,
      ADMIN_TOKEN: "CXASTrainingPortal25",
      ADMIN_PASS:  "cooladmin",
      BRAND:       "Training Portal",
      TIMEZONE:    "America/New_York"
    };
    console.warn("Using FALLBACK APP_CONFIG (config.js missing or stale).");
  }
})();
(function themeBoot(){
  const saved = localStorage.getItem('tp_theme');
  if(saved) document.documentElement.setAttribute('data-theme', saved);
})();
</script>
</head>
<body>
<header>
  <div class="hgrid">
    <div class="left"><a class="btnLink" href="admin.html">Admin</a></div>
    <div class="center"><div class="brand" id="brand"></div></div>
    <div class="right">
      <button id="themeBtn" class="toggle">Dark</button>
      <img src="CX%20Advanced%20Solutions_Smaller_white.png" alt="Logo" class="logo">
    </div>
  </div>
</header>

<main>
  <div class="card" style="max-width:720px;margin:0 auto;">
    <h1>Training Series</h1>
    <div class="sub">Enter your name and your 10-character access code.</div>
    <label>Your name</label>
    <input id="name" placeholder="Jane Doe" autocomplete="off"/>
    <label>Access code</label>
    <input id="code" placeholder="XXXXXXXXXX" maxlength="10" autocomplete="off" style="text-transform:uppercase;"/>
    <div class="row"><button id="enterBtn" class="btn">Enter</button></div>
    <div id="msg" class="err"></div>
  </div>
</main>
<footer>Â© 2025 Training</footer>

<script>
const cfg = window.APP_CONFIG;
document.getElementById('brand').textContent = cfg.BRAND || 'Training Portal';

const themeBtn = document.getElementById('themeBtn');
themeBtn.textContent = (document.documentElement.getAttribute('data-theme')||'dark')==='dark'?'Dark':'Light';
themeBtn.addEventListener('click', ()=>{
  const cur = document.documentElement.getAttribute('data-theme') || 'dark';
  const nxt = cur==='dark' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', nxt);
  localStorage.setItem('tp_theme', nxt);
  themeBtn.textContent = nxt==='dark'?'Dark':'Light';
});

const $ = id => document.getElementById(id);
const msg = $('msg');

$('enterBtn').addEventListener('click', async ()=>{
  msg.textContent = '';
  const name = $('name').value.trim();
  const code = $('code').value.trim().toUpperCase();

  if(!name || code.length!==10){ msg.textContent = 'Please enter your name and a 10-character code.'; return; }

  try{
    const res = await fetch(cfg.SCRIPT_URL, {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ mode:'validate', code })
    });
    const text = await res.text();
    let data; try{ data = JSON.parse(text); }catch{ data=null; }
    if(!res.ok || !data || data.ok!==true){ msg.textContent = (data && data.error) || 'Server error. Please try again.'; return; }

    // best-effort signin log
    fetch(cfg.SCRIPT_URL, {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ mode:'signin', name, course:data.course, company:data.company, ts_client: Date.now(), page:'home', ua:navigator.userAgent })
    }).catch(()=>{});

    sessionStorage.setItem('tp_user', JSON.stringify({ name, course:data.course, company:data.company, started: Date.now() }));
    location.href = 'videos.html';
  }catch(e){
    msg.textContent = 'Network error. Please try again.';
  }
});
</script>
</body>
</html>
